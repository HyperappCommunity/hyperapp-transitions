{"version":3,"sources":["dist/hyperapp-transitions.js"],"names":["global","factory","exports","module","define","amd","transitions","this","setStyle","el","props","Object","keys","forEach","name","style","updateAllTracked","trackingRegistry","updateTracking","invertLastMove","x","_x","y","_y","n","Math","floor","rect","getBoundingClientRect","left","top","runTransition","before","after","ondone","easing","time","delay","setTimeout","requestAnimationFrame","transition","runExit","css","done","i","indexOf","splice","unregisterTracking","translation","transform","noop","transitionComponent","handlersFn","children","handlers","filter","child","map","f1","f2","composeHandlers","addEventListener","_track","oncreate","push","registerTracking","_move","onupdate","runMove","_exit","onremove","parentNode","removeChild","removeElement","keep","enter","reduce","o","runEnter","move","exit","defineProperty","value"],"mappings":"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","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.transitions = {})));\n}(this, (function (exports) { 'use strict';\n\naddEventListener('resize', updateAllTracked);\naddEventListener('scroll', updateAllTracked);\n\nvar trackingRegistry = [];\n\nfunction removeElement (el) {\n    el.parentNode.removeChild(el);\n}\n\nfunction setStyle (el, props) {\n    Object.keys(props)\n    .forEach(function (name) {\n        el.style[name] = props[name];\n    });\n}\n\nfunction registerTracking (el) {\n    if (trackingRegistry.indexOf(el) > -1 ) return\n    updateTracking(el);\n    trackingRegistry.push(el);\n}\n\nfunction unregisterTracking(el) {\n    var i = trackingRegistry.indexOf(el);\n    if (i === -1) return\n    trackingRegistry.splice(i, 1);\n}\n\nfunction updateAllTracked () {\n    trackingRegistry.forEach(updateTracking);  \n} \n\nfunction invertLastMove (el) {\n    var x = el._x;\n    var y = el._y;\n    if (!x) return 'translate(0, 0)'\n    var n = updateTracking(el);\n    var dx = Math.floor(x - n.x);\n    var dy = Math.floor(y - n.y);\n    return 'translate(' + dx + 'px, ' + dy + 'px)'\n}\n\nfunction updateTracking (el) {\n    var rect = el.getBoundingClientRect();\n    el._x = rect.left;\n    el._y = rect.top;\n    return {x: rect.left, y: rect.top}\n}\n\nfunction runTransition (el, props, before, after, ondone) {\n    var easing = props.easing || 'linear';\n    var time = props.time || 300;\n    var delay = props.delay || 0;\n    setStyle(el, before);\n    setTimeout(function () {\n        requestAnimationFrame(function () {\n            setStyle(el, after);\n            el.style.transition = 'all ' + easing + ' ' + time + 'ms';\n            setTimeout(function () {\n                el.style.transition = null;\n                ondone && ondone();\n            }, time);\n        });\n    }, delay);\n}\n\nfunction runEnter (el, props, css) {\n    if (typeof css === 'function') css = css();\n    runTransition(\n        el, props,\n        css,\n        Object.keys(css).reduce(function (o, n) {\n            o[n] = null;\n            return o\n        }, {}),\n        function () { updateTracking(el); }\n    );\n}\n\nfunction runMove (el, props) {\n    runTransition(\n        el, props,\n        {transform: invertLastMove(el)},\n        {transform: null}\n    );\n}\n\nfunction runExit (el, props, css, done) {\n    if (typeof css === 'function') css = css();\n    unregisterTracking(el);\n    var translation = invertLastMove(el);\n    css.transform = translation + (css.transform ? (' ' + css.transform) : '');\n    runTransition(\n        el, props,\n        {transform: translation},\n        css,\n        done\n    );\n}\n    \nfunction noop () {}\n    \nfunction composeHandlers (f1, f2) {\n    if (!f1) return f2\n    if (!f2) return f1\n    return function (el, done) {\n        f1 && f1(el, done);\n        f2 && f2(el, done);\n        return noop\n    }\n}\n\nfunction transitionComponent (handlersFn) {\n    return function (props, children) {\n        var handlers = handlersFn(props || {});\n        return children\n        .filter(function (child) { return !!child.props})\n        .map(function (child) {\n            ['oncreate', 'onupdate', 'onremove'].forEach(function (n) {\n                child.props[n] = composeHandlers(child.props[n], handlers[n]);\n            });  \n            return child\n        })\n    }\n}\n\nvar _track = transitionComponent(function (props) { \n    return {oncreate: function (el) { registerTracking(el);} }\n});\n\nvar _move = transitionComponent(function (props) { \n    return { onupdate: function (el) { runMove(el, props); } }\n});\n\nvar _exit = transitionComponent(function (props) {\n    return {\n        onremove: function (el, done) {\n            done = done || function () { removeElement(el); };\n            runExit(el, props, props.css || {}, !props.keep && done);\n        }\n    }\n});\n\nvar enter = transitionComponent(function (props) {\n    return { oncreate: function (el) { runEnter(el, props, props.css || {}); } }\n});\n\nvar move = function (props, children) {\n    return _move(props, _track(null, children))\n};\n\nvar exit = function (props, children) {\n    return _exit(props, _track(null, children))\n};\n\nexports.enter = enter;\nexports.move = move;\nexports.exit = exit;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=hyperapp-transitions.js.map\n"]}